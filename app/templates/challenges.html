{% extends "base.html" %}

{% block content %}
<style>
  /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è body */
  body {
      background-color: #1e1e1e;
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      overflow-y: auto;
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
  h1 {
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 2rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
  }
.container {
  background-color: unset;
}
  /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤–∫–ª–∞–¥–æ–∫ */
  .tabs {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∫–ª–∞–¥–∫–∏ */
  .tab-link {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 25px;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      text-decoration: none;
      font-size: 16px;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      backdrop-filter: blur(10px);
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ */
  .tab-link.active {
      background: linear-gradient(145deg, rgba(76, 175, 80, 0.8), rgba(69, 160, 73, 0.8));
      border-color: rgba(76, 175, 80, 0.5);
      transform: scale(1.05);
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∫–æ–Ω–æ–∫ */
  .tab-icon {
      font-size: 18px;
  }

  /* –≠—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
  .tab-link:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(76, 175, 80, 0.5);
      transform: scale(1.05);
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á */
  .challenges-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
      padding: 20px;
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–ª–∞–≥–∞ */
  .challenge-item {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid transparent;
      border-radius: 15px;
      padding: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
  }

  /* –ó–µ–ª–µ–Ω–∞—è –æ–±–≤–æ–¥–∫–∞ –¥–ª—è —Ä–µ—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á */
  .challenge-item.solved {
      border-color: rgba(76, 175, 80, 0.8);
  }

  /* –ö—Ä–∞—Å–Ω–∞—è –æ–±–≤–æ–¥–∫–∞ –¥–ª—è –Ω–µ—Ä–µ—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á */
  .challenge-item.unsolved {
      border-color: black;
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏ */
  .challenge-header {
      display: flex;
      align-items: center;
      gap: 15px;
  }

  /* –ò–∫–æ–Ω–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ */
  .status-icon {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: rgba(76, 175, 80, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
  }
  /* –ò–∫–æ–Ω–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫—Ä–∞—Å–Ω–∞—è */
  .status-icon-red {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: red;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
  }
  /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ */
  .difficulty-container {
      display: flex;
      align-items: center;
      gap: 10px;
  }

  /* –ö—Ä—É–∂–æ–∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ */
  .difficulty-circle {
      width: 30px;
      height: 30px;
      position: relative;
  }

  .difficulty-circle svg circle {
      transition: stroke 0.3s ease;
  }

  /* –¢–µ–∫—Å—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ */
  .difficulty {
      margin: 0;
      font-size: 14px;
      color: #e0e0e0;
  }

  /* –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ */
  .challenge-title h3 {
      margin: 0;
      font-size: 1.5rem;
      color: #fff;
  }

  /* –ë–∞–ª–ª—ã –∏ –∫–Ω–æ–ø–∫–∞ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è */
  .challenge-points {
      margin-left: auto;
      text-align: right;
  }

  .challenge-points p {
      margin: 0;
      color: #e0e0e0;
  }

  .challenge-points .received {
      color: rgba(76, 175, 80, 0.8);
  }

  .challenge-points .toggle-button {
      background: none;
      border: none;
      color: #fff;
      font-size: 20px;
      cursor: pointer;
      transition: transform 0.3s ease;
  }

  .challenge-points .toggle-button:hover {
      transform: scale(1.2);
  }

  /* –°–∫—Ä—ã—Ç—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç */
  .challenge-content {
      margin-top: 15px;
      display: none;
  }

  .challenge-info p {
      margin: 5px 0;
      color: #e0e0e0;
  }

  /* –§–æ—Ä–º–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–ª–∞–≥–∞ */
  .challenge-form {
      margin-top: 15px;
  }

  .challenge-form input {
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 8px;
      border-radius: 4px;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      width: 200px;
  }

  .challenge-form button {
      background: linear-gradient(145deg, rgba(76, 175, 80, 0.8), rgba(69, 160, 73, 0.8));
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 10px;
      transition: all 0.3s ease;
  }

  .challenge-form button:hover {
      background: linear-gradient(145deg, rgba(76, 175, 80, 1), rgba(69, 160, 73, 1));
      transform: scale(1.05);
  }

  /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
  @media (max-width: 768px) {
      .tabs {
          flex-direction: column;
          align-items: center;
      }

      .challenge-header {
          flex-direction: column;
          align-items: flex-start;
      }

      .challenge-points {
          margin-left: 0;
          text-align: left;
      }
  }
</style>

<h1>–§–ª–∞–≥–∏</h1>

<!-- –í–∫–ª–∞–¥–∫–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
<div class="tabs">
    <a href="{{ url_for('challenges', filter='all') }}" class="tab-link {% if filter_type == 'all' %}active{% endif %}">
        <span class="tab-icon">üìÇ</span> –í—Å–µ
    </a>
    <a href="{{ url_for('challenges', filter='solved') }}" class="tab-link {% if filter_type == 'solved' %}active{% endif %}">
        <span class="tab-icon">‚úÖ</span> –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ
    </a>
    <a href="{{ url_for('challenges', filter='unsolved') }}" class="tab-link {% if filter_type == 'unsolved' %}active{% endif %}">
        <span class="tab-icon">‚ùå</span> –ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ
    </a>
</div>

<!-- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á -->
<div class="challenges-list">
    {% for challenge in challenges %}
        <div class="challenge-item {% if challenge.solved_by_user(current_user) %}solved{% else %}unsolved{% endif %}">
            <div class="challenge-header">
                <!-- –ò–∫–æ–Ω–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ -->
                {% if not challenge.solved_by_user(current_user) %}
                <div class="status-icon-red">
                  <span class="icon">&times;</span>
                    </div>
                  {% endif %}
                    {% if challenge.solved_by_user(current_user) %}
                    <div class="status-icon">
                        <span class="icon">‚úî</span>
                        </div>
                    {% endif %}

                <div>
                    <!-- –ö—Ä—É–∂–æ–∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ -->
                    <div class="difficulty-container">
                        <div class="difficulty-circle">
                            <svg width="30" height="30" viewBox="0 0 30 30">
                                <circle cx="15" cy="15" r="13" fill="none" stroke="#e0e0e0" stroke-width="3" />
                                <circle cx="15" cy="15" r="13" fill="none" stroke-width="3"
                                        stroke-dasharray="81.681" stroke-dashoffset="81.681"
                                        transform="rotate(-90 15 15)" />
                            </svg>
                        </div>
                        <p class="difficulty">
                            {% if challenge.points >= 0 and challenge.points < 100 %}
                                –ù–∏–∑–∫–∞—è
                            {% elif challenge.points >= 100 and challenge.points < 500 %}
                                –°—Ä–µ–¥–Ω—è—è
                            {% elif challenge.points >= 500 and challenge.points < 1000 %}
                                –°–ª–æ–∂–Ω–∞—è
                            {% elif challenge.points >= 1000 and challenge.points <= 2000 %}
                                –û—á–µ–Ω—å —Å–ª–æ–∂–Ω–∞—è
                            {% endif %}
                        </p>
                    </div>
                    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ -->
                    <div class="challenge-title">
                        <h3>{{ challenge.title }}</h3>
                    </div>
                </div>
                <!-- –ë–∞–ª–ª—ã –∏ –∫–Ω–æ–ø–∫–∞ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è -->
                <div class="challenge-points">
                    <p>{{ challenge.points }} –±–∞–ª–ª–æ–≤</p>
                    {% if challenge.solved_by_user(current_user) %}
                        <p class="received">–ü–æ–ª—É—á–µ–Ω–æ</p>
                    {% endif %}
                    <button class="toggle-button" onclick="toggleDescription(this)">‚ñº</button>
                </div>
            </div>
            <!-- –°–∫—Ä—ã—Ç—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <div class="challenge-content">
                <div class="challenge-info">
                    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ challenge.description }}</p>
                    <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ challenge.category }}</p>
                </div>
                <div class="challenge-form">
                    <form method="POST" action="{{ url_for('submit_flag', challenge_id=challenge.id) }}">
                        <input type="text" name="flag" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–ª–∞–≥" required>
                        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    </form>
                </div>
            </div>
        </div>
    {% endfor %}
</div>

<script>
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –æ–ø–∏—Å–∞–Ω–∏—è
  function toggleDescription(button) {
      const content = button.closest('.challenge-item').querySelector('.challenge-content');
      if (content.style.display === 'none') {
          content.style.display = 'block';
          button.textContent = '‚ñ≤';
      } else {
          content.style.display = 'none';
          button.textContent = '‚ñº';
      }
  }

  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∫—Ä—É–≥–∞ –∏ —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
  document.querySelectorAll('.difficulty-circle svg circle:nth-child(2)').forEach(circle => {
      const challengeItem = circle.closest('.challenge-item');
      const points = parseInt(challengeItem.querySelector('.challenge-points p').textContent);
      let progress, color;

      if (points >= 0 && points < 100) {
          progress = 25;
          color = '#00bcd4'; // –ì–æ–ª—É–±–æ–π
      } else if (points >= 100 && points < 500) {
          progress = 50;
          color = '#ff9800'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π
      } else if (points >= 500 && points < 1000) {
          progress = 75;
          color = '#f44336'; // –ö—Ä–∞—Å–Ω—ã–π
      } else if (points >= 1000 && points <= 2000) {
          progress = 100;
          color = '#9c27b0'; // –§–∏–æ–ª–µ—Ç–æ–≤—ã–π
      }

      const circumference = 2 * Math.PI * 13;
      const offset = circumference - (circumference * progress) / 100;
      circle.style.strokeDashoffset = offset;
      circle.style.stroke = color;
  });
</script>
{% endblock %}
