{% extends "base.html" %}
{% block content %}
<h1>Заполнение шагов для события "{{ event.title }}"</h1>
<form method="POST">
    <div id="steps-container">
        <!-- Первый шаг -->
        <div class="step-form">
            <h3>Шаг <span class="step-number">1</span></h3>
            <div class="form-group">
                <label for="step_name">Название шага</label>
                <input type="text" class="form-control" name="step_name[]" required>
            </div>
            <div class="form-group">
                <label for="description">Описание шага</label>
                <textarea class="form-control" name="description[]"></textarea>
            </div>
            <div class="form-group">
                <label for="responsible">Ответственный</label>
                <input type="text" class="form-control" name="responsible[]">
            </div>
            <div class="form-group">
                <label for="deadline">Срок выполнения</label>
                <input type="datetime-local" class="form-control" name="deadline[]">
            </div>
            <div class="form-group">
                <label for="resources">Ресурсы</label>
                <textarea class="form-control" name="resources[]"></textarea>
            </div>
            <div class="form-group">
                <label for="risks">Риски</label>
                <textarea class="form-control" name="risks[]"></textarea>
            </div>
            <div class="form-group">
                <label for="actions">Действия</label>
                <textarea class="form-control" name="actions[]"></textarea>
            </div>
            <div class="form-group">
                <label for="results">Результаты</label>
                <textarea class="form-control" name="results[]"></textarea>
            </div>
            <div class="form-group">
                <label for="status">Статус выполнения</label>
                <select class="form-control" name="status[]">
                    <option value="Не начато">Не начато</option>
                    <option value="В процессе">В процессе</option>
                    <option value="Завершено">Завершено</option>
                </select>
            </div>
            <div class="form-group">
                <label for="comments">Комментарии</label>
                <textarea class="form-control" name="comments[]"></textarea>
            </div>
            <button type="button" class="btn btn-danger remove-step">Удалить шаг</button>
        </div>
    </div>

    <!-- Кнопка для добавления нового шага -->
    <button type="button" id="add-step-button" class="btn btn-primary">Добавить шаг</button>

    <!-- Кнопка для сохранения шагов -->
    <button type="submit" class="btn btn-success">Сохранить шаги</button>
</form>

<!-- JavaScript для динамического добавления шагов -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const stepsContainer = document.getElementById('steps-container');
        const addStepButton = document.getElementById('add-step-button');
        let stepCounter = 1;

        // Функция для добавления нового шага
        addStepButton.addEventListener('click', function () {
            stepCounter++;
            const newStep = document.createElement('div');
            newStep.classList.add('step-form');
            newStep.innerHTML = `
                <h3>Шаг <span class="step-number">${stepCounter}</span></h3>
                <div class="form-group">
                    <label for="step_name">Название шага</label>
                    <input type="text" class="form-control" name="step_name[]" required>
                </div>
                <div class="form-group">
                    <label for="description">Описание шага</label>
                    <textarea class="form-control" name="description[]"></textarea>
                </div>
                <div class="form-group">
                    <label for="responsible">Ответственный</label>
                    <input type="text" class="form-control" name="responsible[]">
                </div>
                <div class="form-group">
                    <label for="deadline">Срок выполнения</label>
                    <input type="datetime-local" class="form-control" name="deadline[]">
                </div>
                <div class="form-group">
                    <label for="resources">Ресурсы</label>
                    <textarea class="form-control" name="resources[]"></textarea>
                </div>
                <div class="form-group">
                    <label for="risks">Риски</label>
                    <textarea class="form-control" name="risks[]"></textarea>
                </div>
                <div class="form-group">
                    <label for="actions">Действия</label>
                    <textarea class="form-control" name="actions[]"></textarea>
                </div>
                <div class="form-group">
                    <label for="results">Результаты</label>
                    <textarea class="form-control" name="results[]"></textarea>
                </div>
                <div class="form-group">
                    <label for="status">Статус выполнения</label>
                    <select class="form-control" name="status[]">
                        <option value="Не начато">Не начато</option>
                        <option value="В процессе">В процессе</option>
                        <option value="Завершено">Завершено</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="comments">Комментарии</label>
                    <textarea class="form-control" name="comments[]"></textarea>
                </div>
                <button type="button" class="btn btn-danger remove-step">Удалить шаг</button>
            `;
            stepsContainer.appendChild(newStep);

            // Добавляем обработчик для удаления шага
            newStep.querySelector('.remove-step').addEventListener('click', function () {
                stepsContainer.removeChild(newStep);
                stepCounter--;
            });
        });
    });
</script>
{% endblock %}
