{% extends "base_competition.html" %}

{% block content %}
<style media="screen">
  option {
    background-color: black;
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ */
  .filter-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    justify-content: center;
  }

  .filter-buttons .btn {
    background: rgba(255, 255, 255, 0.1);
    padding: 10px 20px;
    border-radius: 25px;
    text-decoration: none;
    font-size: 14px;
    transition: all 0.3s ease;
    border: 1px solid transparent;
    font-size: 18px;
    color: rgba(255, 255, 255, 0.8);
  }

  .filter-buttons .btn.active {
    background: rgba(147, 112, 219, 0.5);
    border-color: rgba(147, 112, 219, 0.7);
  }

  .filter-buttons .btn:hover {
    background: rgba(147, 112, 219, 0.5);
    border-color: rgba(147, 112, 219, 0.7);
    opacity: 0.9;
    font-size: 18px;
    color: rgba(255, 255, 255, 0.8);
  }


</style>

<div class="container">
  <a href="{{ url_for('view_user_competition', competition_id=competition.id) }}" class="back-button">
      ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—é
  </a>
    <h2>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–∏ "{{ competition.title }}"</h2>

    <!-- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º –æ—Ç—á–µ—Ç–æ–≤ -->
    <div class="filter-buttons">
        <button class="btn btn-all active" data-status="all">–í—Å–µ üìÅ</button>
        <button class="btn btn-pending" data-status="pending">–í –æ–∂–∏–¥–∞–Ω–∏–∏ ‚è≥</button>
        <button class="btn btn-approved" data-status="approved">–û–¥–æ–±—Ä–µ–Ω–æ ‚úîÔ∏è</button>
        <button class="btn btn-rejected" data-status="rejected">–û—Ç–∫–ª–æ–Ω–µ–Ω–æ ‚ùå</button>
        <button class="btn btn-needs-revision" data-status="needs_revision">–ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–µ üîÑ</button>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π -->
    <h3>–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
    <table class="event-table">
        <thead>
            <tr>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                <th>–ë–∞–ª–ª—ã</th>
                <th>–°—Ç–∞—Ç—É—Å –æ—Ç—á–µ—Ç–∞</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for event in critical_events %}
            {% set report = event.responses|selectattr("team_id", "equalto", current_user.team.id)|first if current_user.team else None %}
            <tr class="event-row {% if report and report.status == 'approved' %}approved-row{% endif %}" data-report-status="{{ report.status if report else 'none' }}">
                <td>{{ event.title }}</td>
                <td class="event-description">{{ event.description }}</td>
                <td>{{ event.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>{{ event.points }}</td>
                <td>
                    {% if report %}
                    <span class="status-badge {{ report.status }}">{{ report.status }}</span>
                    {% else %}
                    <span class="status-badge none">–ù–µ—Ç –æ—Ç—á–µ—Ç–∞</span>
                    {% endif %}
                </td>
                <td>
                    {% if not report or report.status in ['none', 'rejected', 'needs_revision'] %}
                    <a href="{{ url_for('fill_critical_event', competition_id=competition.id, event_id=event.id) }}" class="btn btn-fill">
                        –ó–∞–ø–æ–ª–Ω–∏—Ç—å –æ—Ç—á–µ—Ç
                    </a>
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" class="no-events">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- –û—Ç—á–µ—Ç—ã –∫–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <h3>–û—Ç—á–µ—Ç—ã –≤–∞—à–µ–π –∫–æ–º–∞–Ω–¥—ã</h3>
    {% if team_reports %}
    <table class="report-table">
        <thead>
            <tr>
                <th>–°–æ–±—ã—Ç–∏–µ</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–ë–∞–ª–ª—ã</th>
            </tr>
        </thead>
        <tbody>
            {% for report in team_reports %}
            <tr>
                <td>{{ report.event.title }}</td>
                <td><span class="status-badge {{ report.status }}">{{ report.status }}</span></td>
                <td>{{ report.points_awarded if report.points_awarded else '–ù–µ—Ç' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="no-reports">–í–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞ –æ—Ç—á–µ—Ç—ã.</p>
    {% endif %}
</div>

<!-- JavaScript –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const filterButtons = document.querySelectorAll('.filter-buttons .btn');
        const eventRows = document.querySelectorAll('.event-row');

        filterButtons.forEach(button => {
            button.addEventListener('click', function () {
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                filterButtons.forEach(btn => btn.classList.remove('active'));
                // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –∫–Ω–æ–ø–∫–µ
                this.classList.add('active');

                const selectedStatus = this.getAttribute('data-status');

                eventRows.forEach(row => {
                    const reportStatus = row.getAttribute('data-report-status');
                    if (selectedStatus === 'all' || reportStatus === selectedStatus) {
                        row.style.display = 'table-row';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
        });
    });
</script>
{% endblock %}
